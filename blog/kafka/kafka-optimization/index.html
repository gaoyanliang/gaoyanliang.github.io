<!DOCTYPE html>
<html lang='en'>

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  <title>kafka</title>

  
    <meta name="description" content="æ€§èƒ½é—®é¢˜ä¸€èˆ¬å¸¸å‡ºç°åœ¨ä¸‰ä¸ªåœ°æ–¹:  ç½‘ç»œ ç£ç›˜ å¤æ‚åº¦  åœ¨ kafka ä¸­æ€§èƒ½çš„ä¼˜åŒ–ä¸»è¦ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š  Producer Consumer Borker  kafka ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é˜Ÿåˆ—ï¼Œç½‘ç»œå’Œç£ç›˜æ›´æ˜¯ä¼˜åŒ–çš„é‡ä¸­ä¹‹é‡ã€‚kafka ä¸­çš„ä¼˜åŒ–æ‰‹æ®µä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š  å‹ç¼© ç¼“å­˜ æ‰¹é‡ å¹¶å‘ ç®—æ³•">
<meta property="og:type" content="article">
<meta property="og:title" content="Kafka ç³»åˆ—(ä¸ƒ)ï¼škafka å¯¹æ€§èƒ½çš„ä¼˜åŒ–">
<meta property="og:url" content="https://yanliang.cool/blog/kafka/kafka-optimization/">
<meta property="og:site_name" content="yanliang">
<meta property="og:description" content="æ€§èƒ½é—®é¢˜ä¸€èˆ¬å¸¸å‡ºç°åœ¨ä¸‰ä¸ªåœ°æ–¹:  ç½‘ç»œ ç£ç›˜ å¤æ‚åº¦  åœ¨ kafka ä¸­æ€§èƒ½çš„ä¼˜åŒ–ä¸»è¦ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š  Producer Consumer Borker  kafka ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é˜Ÿåˆ—ï¼Œç½‘ç»œå’Œç£ç›˜æ›´æ˜¯ä¼˜åŒ–çš„é‡ä¸­ä¹‹é‡ã€‚kafka ä¸­çš„ä¼˜åŒ–æ‰‹æ®µä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š  å‹ç¼© ç¼“å­˜ æ‰¹é‡ å¹¶å‘ ç®—æ³•">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/gaoyanliang/blogImgs/blog/img/post/kafka/kafka13.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/gaoyanliang/blogImgs/blog/img/post/kafka/kafka14.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/gaoyanliang/blogImgs/blog/img/post/kafka/kafka15.png">
<meta property="article:published_time" content="2021-08-19T00:00:00.000Z">
<meta property="article:modified_time" content="2021-08-19T00:00:00.000Z">
<meta property="article:author" content="yanliang">
<meta property="article:tag" content="kafka">
<meta property="article:tag" content="æ€§èƒ½ä¼˜åŒ–">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/gaoyanliang/blogImgs/blog/img/post/kafka/kafka13.png">
  
  

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/gaoyanliang/cdn@main/blog/img/icon.svg">
  

  

  


  
</head>

<body>
  


  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://cdn.jsdelivr.net/gh/gaoyanliang/cdn@main/blog/img/index-head.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title"><div style="line-height: 1.5; letter-spacing: 3px; position: relative;">Yanliang</div> <div style="font-size: .85rem; letter-spacing: 1px; font-weight: 500;">Believe in yourself.</div></div></a></div>

<nav class="menu dis-select"><a class="nav-item active" href="/">Blog</a><a class="nav-item" href="/wiki/">Wiki</a><a class="nav-item" href="/friends/">Friends</a><a class="nav-item" href="/about/">More</a></nav></header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" placeholder="Search"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div></div></widget>

<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">Kafka ç³»åˆ—(ä¸ƒ)ï¼škafka å¯¹æ€§èƒ½çš„ä¼˜åŒ–</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E5%86%99"><span class="toc-text">é¡ºåºå†™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%B6%E6%8B%B7%E8%B4%9D"><span class="toc-text">é›¶æ‹·è´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PageCache"><span class="toc-text">PageCache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-text">ç½‘ç»œæ¨¡å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%92%8C%E5%8E%8B%E7%BC%A9"><span class="toc-text">æ‰¹é‡å’Œå‹ç¼©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E5%B9%B6%E5%8F%91"><span class="toc-text">åˆ†åŒºå¹¶å‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E6%95%88%E7%9A%84%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text">é«˜æ•ˆçš„æ–‡ä»¶æ•°æ®ç»“æ„</span></a></li></ol></div></div></widget>


</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" title="Back to Top" href="#start" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/gaoyanliang/cdn@main/blog/img/social/top.svg"/></a><a class="social" title="GitHub" href="https://github.com/gyl-coder/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/gaoyanliang/cdn@main/blog/img/social/github.svg"/></a><a class="social" title="Spotify" href="https://open.spotify.com/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/gaoyanliang/cdn@main/blog/img/social/music.svg"/></a><a class="social" title="Unsplash" href="https://unsplash.com/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/gaoyanliang/cdn@main/blog/img/social/music.svg"/></a><a class="social" title="Comments" href="/about/#comments" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/gaoyanliang/cdn@main/blog/img/social/message.svg"/></a></div></footer>

    </aside>
    <div class='l_main'>
      

      


<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a><span class="sep"></span><a class="cap breadcrumb" href="/">Blog</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/kafka/">kafka</a></div><div id="post-meta">ğŸ’§ Posted on&nbsp;<time datetime="2021-08-19T00:00:00.000Z">Aug 19, 2021</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>Kafka ç³»åˆ—(ä¸ƒ)ï¼škafka å¯¹æ€§èƒ½çš„ä¼˜åŒ–</span></h1>
<p>æ€§èƒ½é—®é¢˜ä¸€èˆ¬å¸¸å‡ºç°åœ¨ä¸‰ä¸ªåœ°æ–¹:</p>
<ul>
<li>ç½‘ç»œ</li>
<li>ç£ç›˜</li>
<li>å¤æ‚åº¦</li>
</ul>
<p>åœ¨ kafka ä¸­æ€§èƒ½çš„ä¼˜åŒ–ä¸»è¦ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>Producer</li>
<li>Consumer</li>
<li>Borker</li>
</ul>
<p>kafka ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é˜Ÿåˆ—ï¼Œç½‘ç»œå’Œç£ç›˜æ›´æ˜¯ä¼˜åŒ–çš„é‡ä¸­ä¹‹é‡ã€‚kafka ä¸­çš„ä¼˜åŒ–æ‰‹æ®µä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>å‹ç¼©</li>
<li>ç¼“å­˜</li>
<li>æ‰¹é‡</li>
<li>å¹¶å‘</li>
<li>ç®—æ³•</li>
</ul>
<span id="more"></span>

<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/gaoyanliang/blogImgs/blog/img/post/kafka/kafka13.png" fancybox="true"/></div></div>

<h2 id="é¡ºåºå†™"><a href="#é¡ºåºå†™" class="headerlink" title="é¡ºåºå†™"></a>é¡ºåºå†™</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œå®Œæˆä¸€æ¬¡ç£ç›˜IOï¼Œéœ€è¦ç»è¿‡ <strong>å¯»é“ã€æ—‹è½¬å’Œæ•°æ®ä¼ è¾“</strong> ä¸‰ä¸ªæ­¥éª¤ã€‚</p>
<p>å½±å“ç£ç›˜ IO æ€§èƒ½çš„å› ç´ ä¹Ÿå°±å‘ç”Ÿåœ¨ä¸Šé¢ä¸‰ä¸ªæ­¥éª¤ä¸Šï¼Œå› æ­¤ä¸»è¦èŠ±è´¹çš„æ—¶é—´å°±æ˜¯ï¼š</p>
<ul>
<li>å¯»é“æ—¶é—´ï¼šTseek æ˜¯æŒ‡å°†è¯»å†™ç£å¤´ç§»åŠ¨è‡³æ­£ç¡®çš„ç£é“ä¸Šæ‰€éœ€è¦çš„æ—¶é—´ã€‚å¯»é“æ—¶é—´è¶ŠçŸ­ï¼ŒI&#x2F;O æ“ä½œè¶Šå¿«ï¼Œç›®å‰ç£ç›˜çš„å¹³å‡å¯»é“æ—¶é—´ä¸€èˆ¬åœ¨ 3-15msã€‚</li>
<li>æ—‹è½¬å»¶è¿Ÿï¼šTrotation æ˜¯æŒ‡ç›˜ç‰‡æ—‹è½¬å°†è¯·æ±‚æ•°æ®æ‰€åœ¨çš„æ‰‡åŒºç§»åŠ¨åˆ°è¯»å†™ç£ç›˜ä¸‹æ–¹æ‰€éœ€è¦çš„æ—¶é—´ã€‚æ—‹è½¬å»¶è¿Ÿå–å†³äºç£ç›˜è½¬é€Ÿï¼Œé€šå¸¸ç”¨ç£ç›˜æ—‹è½¬ä¸€å‘¨æ‰€éœ€æ—¶é—´çš„ 1&#x2F;2 è¡¨ç¤ºã€‚æ¯”å¦‚ï¼š7200rpm çš„ç£ç›˜å¹³å‡æ—‹è½¬å»¶è¿Ÿå¤§çº¦ä¸º 60*1000&#x2F;7200&#x2F;2 &#x3D; 4.17msï¼Œè€Œè½¬é€Ÿä¸º 15000rpm çš„ç£ç›˜å…¶å¹³å‡æ—‹è½¬å»¶è¿Ÿä¸º 2msã€‚</li>
<li>æ•°æ®ä¼ è¾“æ—¶é—´ï¼šTtransfer æ˜¯æŒ‡å®Œæˆä¼ è¾“æ‰€è¯·æ±‚çš„æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´ï¼Œå®ƒå–å†³äºæ•°æ®ä¼ è¾“ç‡ï¼Œå…¶å€¼ç­‰äºæ•°æ®å¤§å°é™¤ä»¥æ•°æ®ä¼ è¾“ç‡ã€‚ç›®å‰ IDE&#x2F;ATA èƒ½è¾¾åˆ° 133MB&#x2F;sï¼ŒSATA II å¯è¾¾åˆ° 300MB&#x2F;s çš„æ¥å£æ•°æ®ä¼ è¾“ç‡ï¼Œæ•°æ®ä¼ è¾“æ—¶é—´é€šå¸¸è¿œå°äºå‰ä¸¤éƒ¨åˆ†æ¶ˆè€—æ—¶é—´ã€‚ç®€å•è®¡ç®—æ—¶å¯å¿½ç•¥ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå¦‚æœåœ¨å†™ç£ç›˜çš„æ—¶å€™çœå»å¯»é“ã€æ—‹è½¬å¯ä»¥æå¤§åœ°æé«˜ç£ç›˜è¯»å†™çš„æ€§èƒ½ã€‚</p>
<blockquote>
<p>Kafka é‡‡ç”¨é¡ºåºå†™æ–‡ä»¶çš„æ–¹å¼æ¥æé«˜ç£ç›˜å†™å…¥æ€§èƒ½ã€‚é¡ºåºå†™æ–‡ä»¶ï¼ŒåŸºæœ¬å‡å°‘äº†ç£ç›˜å¯»é“å’Œæ—‹è½¬çš„æ¬¡æ•°ã€‚ç£å¤´å†ä¹Ÿä¸ç”¨åœ¨ç£é“ä¸Šä¹±èˆäº†ï¼Œè€Œæ˜¯ä¸€è·¯å‘å‰é£é€Ÿå‰è¡Œã€‚</p>
</blockquote>
<p>Kafka ä¸­æ¯ä¸ªåˆ†åŒºæ˜¯ä¸€ä¸ªæœ‰åºçš„ï¼Œä¸å¯å˜çš„æ¶ˆæ¯åºåˆ—ï¼Œæ–°çš„æ¶ˆæ¯ä¸æ–­è¿½åŠ åˆ° Partition çš„æœ«å°¾ï¼Œåœ¨ Kafka ä¸­ Partition åªæ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼ŒKafka å°† Partition åˆ’åˆ†ä¸ºå¤šä¸ª Segmentï¼Œæ¯ä¸ª Segment å¯¹åº”ä¸€ä¸ªç‰©ç†æ–‡ä»¶ï¼ŒKafka å¯¹ segment æ–‡ä»¶è¿½åŠ å†™ï¼Œè¿™å°±æ˜¯é¡ºåºå†™æ–‡ä»¶ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆ Kafka å¯ä»¥ä½¿ç”¨è¿½åŠ å†™çš„æ–¹å¼å‘¢ï¼Ÿ</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œkafka æ•°æ®å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—æ˜¯ FIFO å…ˆè¿›å…ˆå‡ºæ¨¡å‹ï¼Œä¿è¯äº†æ•°æ®çš„æœ‰åºï¼ˆåŒä¸€partitionï¼‰ã€‚æ­£æ˜¯ç”±äºkafka è¿™ç§ä¸å¯å˜æ€§ã€æœ‰åºæ€§ä½¿å¾— kafka å¯ä»¥ä½¿ç”¨è¿½åŠ å†™çš„æ–¹å¼å†™æ–‡ä»¶ã€‚</p>
<h2 id="é›¶æ‹·è´"><a href="#é›¶æ‹·è´" class="headerlink" title="é›¶æ‹·è´"></a>é›¶æ‹·è´</h2><p>é›¶æ‹·è´çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°½é‡å»å‡å°‘æ•°æ®çš„æ‹·è´æ¬¡æ•°ï¼Œä»è€Œå‡å°‘æ‹·è´çš„ CPU å¼€é”€ï¼Œä»¥åŠç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œä»è€Œä¼˜åŒ–æ•°æ®ä¼ è¾“çš„æ€§èƒ½ã€‚</p>
<p>æœ‰å…³é›¶æ‹·è´çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒï¼š <a href="https://yanliang.cool/os/zero-copy/">é›¶æ‹·è´</a></p>
<h2 id="PageCache"><a href="#PageCache" class="headerlink" title="PageCache"></a>PageCache</h2><p>producer å‘é€æ¶ˆæ¯åˆ° Broker æ—¶ï¼ŒBroker ä¼šä½¿ç”¨ write() ç³»ç»Ÿè°ƒç”¨ (å¯¹åº”åˆ° Java NIO çš„ FileChannel.write() API)ï¼ŒæŒ‰åç§»é‡å†™å…¥æ•°æ®ï¼Œæ­¤æ—¶æ•°æ®éƒ½ä¼šå…ˆå†™å…¥page cacheã€‚consumer æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼ŒBroker ä½¿ç”¨ sendfile() ç³»ç»Ÿè°ƒç”¨ (å¯¹åº” FileChannel.transferTo() API)ï¼Œä»¥<a href="https://yanliang.cool/os/zero-copy">é›¶æ‹·è´</a> çš„æ–¹å¼å°†æ•°æ®ä» page cache ä¼ è¾“åˆ° broker çš„ Socket bufferï¼Œç„¶åå†é€šè¿‡ç½‘ç»œä¼ è¾“ã€‚</p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/gaoyanliang/blogImgs/blog/img/post/kafka/kafka14.png" fancybox="true"/></div></div>

<p>leader ä¸ follower ä¹‹é—´çš„åŒæ­¥ï¼Œä¸ä¸Šé¢ consumer æ¶ˆè´¹æ•°æ®çš„è¿‡ç¨‹æ˜¯åŒç†çš„ã€‚</p>
<p>page cacheä¸­çš„æ•°æ®ä¼šéšç€å†…æ ¸ä¸­ flusher çº¿ç¨‹çš„è°ƒåº¦ä»¥åŠå¯¹ sync()&#x2F;fsync() çš„è°ƒç”¨å†™å›åˆ°ç£ç›˜ï¼Œå°±ç®—è¿›ç¨‹å´©æºƒï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒæ•°æ®ä¸¢å¤±ã€‚å¦å¤–ï¼Œå¦‚æœ consumer è¦æ¶ˆè´¹çš„æ¶ˆæ¯ä¸åœ¨page cacheé‡Œï¼Œæ‰ä¼šå»ç£ç›˜è¯»å–ï¼Œå¹¶ä¸”ä¼šé¡ºä¾¿é¢„è¯»å‡ºä¸€äº›ç›¸é‚»çš„å—æ”¾å…¥ page cacheï¼Œä»¥æ–¹ä¾¿ä¸‹ä¸€æ¬¡è¯»å–ã€‚</p>
<p>å› æ­¤å¦‚æœ Kafka producer çš„ç”Ÿäº§é€Ÿç‡ä¸ consumer çš„æ¶ˆè´¹é€Ÿç‡ç›¸å·®ä¸å¤§ï¼Œé‚£ä¹ˆå°±èƒ½å‡ ä¹åªé å¯¹ broker page cache çš„è¯»å†™å®Œæˆæ•´ä¸ªç”Ÿäº§ - æ¶ˆè´¹è¿‡ç¨‹ï¼Œç£ç›˜è®¿é—®éå¸¸å°‘ã€‚</p>
<h2 id="ç½‘ç»œæ¨¡å‹"><a href="#ç½‘ç»œæ¨¡å‹" class="headerlink" title="ç½‘ç»œæ¨¡å‹"></a>ç½‘ç»œæ¨¡å‹</h2><p>Kafka è‡ªå·±å®ç°äº†ç½‘ç»œæ¨¡å‹åš RPCã€‚åº•å±‚åŸºäº Java NIOï¼Œé‡‡ç”¨å’Œ Netty ä¸€æ ·çš„ Reactor çº¿ç¨‹æ¨¡å‹ã€‚</p>
<p>è¿™éƒ¨åˆ†æš‚æ—¶è¿˜æœªç»†ç©¶ã€‚ã€‚ã€‚</p>
<h2 id="æ‰¹é‡å’Œå‹ç¼©"><a href="#æ‰¹é‡å’Œå‹ç¼©" class="headerlink" title="æ‰¹é‡å’Œå‹ç¼©"></a>æ‰¹é‡å’Œå‹ç¼©</h2><p>Kafka Producer å‘ Broker å‘é€æ¶ˆæ¯ä¸æ˜¯ä¸€æ¡æ¶ˆæ¯ä¸€æ¡æ¶ˆæ¯çš„å‘é€ã€‚Producer æœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼šbatch.sizeå’Œlinger.msã€‚è¿™ä¸¤ä¸ªå‚æ•°å°±å’Œ Producer çš„æ‰¹é‡å‘é€æœ‰å…³ã€‚</p>
<p>åœ¨ producer ç«¯ï¼Œæ¶ˆæ¯åœ¨ç»è¿‡æ‹¦æˆªå™¨ã€åºåˆ—åŒ–å™¨ã€åˆ†åŒºå™¨ä¹‹åä¼šç¼“å­˜åˆ°æ¶ˆæ¯ç´¯åŠ å™¨ï¼ˆRecordAccumulatorï¼‰ä¸­ï¼Œæ¶ˆæ¯ç´¯åŠ å™¨ä¸»è¦ç”¨æ¥ç¼“å­˜æ¶ˆæ¯ï¼Œä»¥ä¾¿ Sender çº¿ç¨‹å¯ä»¥æ‰¹é‡å‘é€ï¼Œè¿›è€Œå‡å°‘ç½‘ç»œä¼ è¾“çš„èµ„æºæ¶ˆè€—ä»¥æå‡æ€§èƒ½ã€‚</p>
<p>Kafka æ”¯æŒå¤šç§å‹ç¼©ç®—æ³•ï¼šlz4ã€snappyã€gzipã€‚Kafka 2.1.0 æ­£å¼æ”¯æŒ ZStandard â€”â€” ZStandard æ˜¯ Facebook å¼€æºçš„å‹ç¼©ç®—æ³•ï¼Œæ—¨åœ¨æä¾›è¶…é«˜çš„å‹ç¼©æ¯”</p>
<p>Producerã€Broker å’Œ Consumer ä½¿ç”¨ç›¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œåœ¨ producer å‘ Broker å†™å…¥æ•°æ®ï¼ŒConsumer å‘ Broker è¯»å–æ•°æ®æ—¶ç”šè‡³å¯ä»¥ä¸ç”¨è§£å‹ç¼©ï¼Œæœ€ç»ˆåœ¨ Consumer Poll åˆ°æ¶ˆæ¯æ—¶æ‰è§£å‹ï¼Œè¿™æ ·èŠ‚çœäº†å¤§é‡çš„ç½‘ç»œå’Œç£ç›˜å¼€é”€ã€‚</p>
<h2 id="åˆ†åŒºå¹¶å‘"><a href="#åˆ†åŒºå¹¶å‘" class="headerlink" title="åˆ†åŒºå¹¶å‘"></a>åˆ†åŒºå¹¶å‘</h2><p>Kafka çš„ Topic å¯ä»¥åˆ†æˆå¤šä¸ª Partitionï¼Œæ¯ä¸ª Paritition ç±»ä¼¼äºä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¿è¯æ•°æ®æœ‰åºã€‚åŒä¸€ä¸ª Consumer Group ä¸‹çš„ä¸åŒ Consumer å¹¶å‘æ¶ˆè´¹ Parititionï¼Œåˆ†åŒºå®é™…ä¸Šæ˜¯è°ƒä¼˜ Kafka å¹¶è¡Œåº¦çš„æœ€å°å•å…ƒï¼Œå› æ­¤ï¼Œå¯ä»¥è¯´ï¼Œæ¯å¢åŠ ä¸€ä¸ª Paritition å°±å¢åŠ äº†ä¸€ä¸ªæ¶ˆè´¹å¹¶å‘ã€‚</p>
<p>Kafka å…·æœ‰ä¼˜ç§€çš„åˆ†åŒºåˆ†é…ç®—æ³•â€”â€”StickyAssignorï¼Œå¯ä»¥ä¿è¯åˆ†åŒºçš„åˆ†é…å°½é‡åœ°å‡è¡¡ï¼Œä¸”æ¯ä¸€æ¬¡é‡åˆ†é…çš„ç»“æœå°½é‡ä¸ä¸Šä¸€æ¬¡åˆ†é…ç»“æœä¿æŒä¸€è‡´ã€‚è¿™æ ·ï¼Œæ•´ä¸ªé›†ç¾¤çš„åˆ†åŒºå°½é‡åœ°å‡è¡¡ï¼Œå„ä¸ª Broker å’Œ Consumer çš„å¤„ç†ä¸è‡³äºå‡ºç°å¤ªå¤§çš„å€¾æ–œã€‚</p>
<blockquote>
<p>åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½ï¼Ÿ  <strong>ä¸æ˜¯</strong></p>
</blockquote>
<p><strong>è¶Šå¤šçš„åˆ†åŒºéœ€è¦æ‰“å¼€æ›´å¤šçš„æ–‡ä»¶å¥æŸ„</strong></p>
<p>åœ¨ kafka çš„ broker ä¸­ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½ä¼šå¯¹ç…§ç€æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªç›®å½•ã€‚åœ¨ kafka çš„æ•°æ®æ—¥å¿—æ–‡ä»¶ç›®å½•ä¸­ï¼Œæ¯ä¸ªæ—¥å¿—æ•°æ®æ®µéƒ½ä¼šåˆ†é…ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªç´¢å¼•æ–‡ä»¶å’Œä¸€ä¸ªæ•°æ®æ–‡ä»¶ã€‚å› æ­¤ï¼Œéšç€ partition çš„å¢å¤šï¼Œéœ€è¦çš„æ–‡ä»¶å¥æŸ„æ•°æ€¥å‰§å¢åŠ ï¼Œå¿…è¦æ—¶éœ€è¦è°ƒæ•´æ“ä½œç³»ç»Ÿå…è®¸æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°ã€‚</p>
<p><strong>å®¢æˆ·ç«¯ &#x2F; æœåŠ¡å™¨ç«¯éœ€è¦ä½¿ç”¨çš„å†…å­˜å°±è¶Šå¤š</strong></p>
<p>å®¢æˆ·ç«¯ producer æœ‰ä¸ªå‚æ•° batch.sizeï¼Œé»˜è®¤æ˜¯ 16KBã€‚å®ƒä¼šä¸ºæ¯ä¸ªåˆ†åŒºç¼“å­˜æ¶ˆæ¯ï¼Œä¸€æ—¦æ»¡äº†å°±æ‰“åŒ…å°†æ¶ˆæ¯æ‰¹é‡å‘å‡ºã€‚çœ‹ä¸Šå»è¿™æ˜¯ä¸ªèƒ½å¤Ÿæå‡æ€§èƒ½çš„è®¾è®¡ã€‚ä¸è¿‡å¾ˆæ˜¾ç„¶ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°æ˜¯åˆ†åŒºçº§åˆ«çš„ï¼Œå¦‚æœåˆ†åŒºæ•°è¶Šå¤šï¼Œè¿™éƒ¨åˆ†ç¼“å­˜æ‰€éœ€çš„å†…å­˜å ç”¨ä¹Ÿä¼šæ›´å¤šã€‚</p>
<p><strong>é™ä½é«˜å¯ç”¨æ€§</strong></p>
<p>åˆ†åŒºè¶Šå¤šï¼Œæ¯ä¸ª Broker ä¸Šåˆ†é…çš„åˆ†åŒºä¹Ÿå°±è¶Šå¤šï¼Œå½“ä¸€ä¸ªå‘ç”Ÿ Broker å®•æœºï¼Œé‚£ä¹ˆæ¢å¤æ—¶é—´å°†å¾ˆé•¿ã€‚</p>
<h2 id="é«˜æ•ˆçš„æ–‡ä»¶æ•°æ®ç»“æ„"><a href="#é«˜æ•ˆçš„æ–‡ä»¶æ•°æ®ç»“æ„" class="headerlink" title="é«˜æ•ˆçš„æ–‡ä»¶æ•°æ®ç»“æ„"></a>é«˜æ•ˆçš„æ–‡ä»¶æ•°æ®ç»“æ„</h2><p>Kafka æ¶ˆæ¯æ˜¯ä»¥ Topic ä¸ºå•ä½è¿›è¡Œå½’ç±»ï¼Œå„ä¸ª Topic ä¹‹é—´å½¼æ­¤ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ã€‚æ¯ä¸ª Topic åˆå¯ä»¥åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºã€‚æ¯ä¸ªåˆ†åŒºå„è‡ªå­˜åœ¨ä¸€ä¸ªè®°å½•æ¶ˆæ¯æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>Kafka æ¯ä¸ªåˆ†åŒºæ—¥å¿—åœ¨ç‰©ç†ä¸Šå®é™…æŒ‰å¤§å°è¢«åˆ†æˆå¤šä¸ª Segmentã€‚</p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/gaoyanliang/blogImgs/blog/img/post/kafka/kafka15.png" fancybox="true"/></div></div>

<ul>
<li>segment file ç»„æˆï¼šæ¯ä¸ªLogSegment å¯¹åº”äºç£ç›˜ä¸Šçš„ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å’Œä¸¤ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œåç¼€ <code>.index</code>ã€ <code>.timeindex</code> ã€<code>.log</code> åˆ†åˆ«è¡¨ç¤ºä¸º segment ç´¢å¼•æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶ã€‚</li>
<li>segment æ–‡ä»¶å‘½åè§„åˆ™ï¼špartion å…¨å±€çš„ç¬¬ä¸€ä¸ª segment ä» 0 å¼€å§‹ï¼Œåç»­æ¯ä¸ª segment æ–‡ä»¶åä¸ºä¸Šä¸€ä¸ª segment æ–‡ä»¶æœ€åä¸€æ¡æ¶ˆæ¯çš„ offset å€¼ã€‚æ•°å€¼æœ€å¤§ä¸º 64 ä½ long å¤§å°ï¼Œ19 ä½æ•°å­—å­—ç¬¦é•¿åº¦ï¼Œæ²¡æœ‰æ•°å­—ç”¨ 0 å¡«å……ã€‚</li>
</ul>
<p>Kafka ä¸­çš„ç´¢å¼•æ–‡ä»¶ä»¥ç¨€ç–ç´¢å¼•ï¼ˆsparse indexï¼‰çš„æ–¹å¼æ„é€ æ¶ˆæ¯çš„ç´¢å¼•ï¼Œå®ƒå¹¶ä¸ä¿è¯æ¯ä¸ªæ¶ˆæ¯åœ¨ç´¢å¼•æ–‡ä»¶ä¸­éƒ½æœ‰å¯¹åº”çš„ç´¢å¼•é¡¹ã€‚æ¯å½“å†™å…¥ä¸€å®šé‡ï¼ˆç”± broker ç«¯å‚æ•° log.index.interval.bytesæŒ‡å®šï¼Œé»˜è®¤å€¼ä¸º4096ï¼Œå³4KBï¼‰çš„æ¶ˆæ¯æ—¶ï¼Œåç§»é‡ç´¢å¼•æ–‡ä»¶å’Œæ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶åˆ†åˆ«å¢åŠ ä¸€ä¸ªåç§»é‡ç´¢å¼•é¡¹å’Œæ—¶é—´æˆ³ç´¢å¼•é¡¹ï¼Œå¢å¤§æˆ–å‡å°log.index.interval.bytesçš„å€¼ï¼Œå¯¹åº”åœ°å¯ä»¥å¢åŠ æˆ–ç¼©å°ç´¢å¼•é¡¹çš„å¯†åº¦ã€‚</p>
<p>ç¨€ç–ç´¢å¼•é€šè¿‡ mmap çš„æ–¹å¼ï¼Œå°† index æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ï¼Œè¿™æ ·å¯¹ index çš„æ“ä½œå°±ä¸éœ€è¦æ“ä½œç£ç›˜ IOï¼Œä»¥åŠ å¿«ç´¢å¼•çš„æŸ¥è¯¢é€Ÿåº¦ã€‚mmapçš„ Java å®ç°å¯¹åº” MappedByteBuffer ã€‚</p>
<blockquote>
<p>mmap æ˜¯ä¸€ç§å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–¹æ³•ã€‚å³å°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å…¶å®ƒå¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå®ç°æ–‡ä»¶ç£ç›˜åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸€æ®µè™šæ‹Ÿåœ°å€çš„ä¸€ä¸€å¯¹æ˜ å…³ç³»ã€‚å®ç°è¿™æ ·çš„æ˜ å°„å…³ç³»åï¼Œè¿›ç¨‹å°±å¯ä»¥é‡‡ç”¨æŒ‡é’ˆçš„æ–¹å¼è¯»å†™æ“ä½œè¿™ä¸€æ®µå†…å­˜ï¼Œè€Œç³»ç»Ÿä¼šè‡ªåŠ¨å›å†™è„é¡µé¢åˆ°å¯¹åº”çš„æ–‡ä»¶ç£ç›˜ä¸Šï¼Œå³å®Œæˆäº†å¯¹æ–‡ä»¶çš„æ“ä½œè€Œä¸å¿…å†è°ƒç”¨ read,write ç­‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚ç›¸åï¼Œå†…æ ¸ç©ºé—´å¯¹è¿™æ®µåŒºåŸŸçš„ä¿®æ”¹ä¹Ÿç›´æ¥åæ˜ ç”¨æˆ·ç©ºé—´ï¼Œä»è€Œå¯ä»¥å®ç°ä¸åŒè¿›ç¨‹é—´çš„æ–‡ä»¶å…±äº«ã€‚<br>mmap è¯¦æƒ…å¯å‚è€ƒ <a href="https://yanliang.cool/os/mmap/">ç³»ç»Ÿè°ƒç”¨ mmap</a></p>
</blockquote>
<p>åç§»é‡ç´¢å¼•æ–‡ä»¶ä¸­çš„åç§»é‡æ˜¯å•è°ƒé€’å¢çš„ï¼ŒæŸ¥è¯¢æŒ‡å®šåç§»é‡æ—¶ï¼Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æ¥å¿«é€Ÿå®šä½åç§»é‡çš„ä½ç½®ï¼Œå¦‚æœæŒ‡å®šçš„åç§»é‡ä¸åœ¨ç´¢å¼•æ–‡ä»¶ä¸­ï¼Œåˆ™ä¼šè¿”å›å°äºæŒ‡å®šåç§»é‡çš„æœ€å¤§åç§»é‡ã€‚</p>
<p>æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶ä¸­çš„æ—¶é—´æˆ³ä¹Ÿä¿æŒä¸¥æ ¼çš„å•è°ƒé€’å¢ï¼ŒæŸ¥è¯¢æŒ‡å®šæ—¶é—´æˆ³æ—¶ï¼Œä¹Ÿæ ¹æ®äºŒåˆ†æŸ¥æ‰¾æ³•æ¥æŸ¥æ‰¾ä¸å¤§äºè¯¥æ—¶é—´æˆ³çš„æœ€å¤§åç§»é‡ï¼Œè‡³äºè¦æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†æ–‡ä»¶ä½ç½®è¿˜éœ€è¦æ ¹æ®åç§»é‡ç´¢å¼•æ–‡ä»¶æ¥è¿›è¡Œå†æ¬¡å®šä½ã€‚</p>
<p>ç¨€ç–ç´¢å¼•çš„æ–¹å¼æ˜¯åœ¨ç£ç›˜ç©ºé—´ã€å†…å­˜ç©ºé—´ã€æŸ¥æ‰¾æ—¶é—´ç­‰å¤šæ–¹é¢ä¹‹é—´çš„ä¸€ä¸ªæŠ˜ä¸­ã€‚</p>
<ul>
<li>æŒ‰ç…§äºŒåˆ†æ³•æ‰¾åˆ°å°äº offset çš„ segment çš„.log å’Œ.index</li>
<li>ç”¨ç›®æ ‡ offset å‡å»æ–‡ä»¶åä¸­çš„ offset å¾—åˆ°æ¶ˆæ¯åœ¨è¿™ä¸ª segment ä¸­çš„åç§»é‡ã€‚</li>
<li>å†æ¬¡ç”¨äºŒåˆ†æ³•åœ¨ index æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•ã€‚</li>
<li>åˆ° log æ–‡ä»¶ä¸­ï¼Œé¡ºåºæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ° offset å¯¹åº”çš„æ¶ˆæ¯ã€‚</li>
</ul>
<p><strong>å‚è€ƒæ–‡ç« ï¼š</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/9i4lDtWqOrzJbzN1I1yAwg">https://mp.weixin.qq.com/s/9i4lDtWqOrzJbzN1I1yAwg</a></li>
</ul>


<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>License</span></div><div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">Newer</div><a href="/blog/kafka/lost_messages/">Kafka ç³»åˆ—(å…«)ï¼šå¦‚ä½•é¿å…æ¶ˆæ¯ä¸¢å¤±?</a></div><div class="item" id="next"><div class="note">Older</div><a href="/blog/kafka/kafka-idempotence/">Kafka ç³»åˆ—(å…­)ï¼šå¹‚ç­‰å®ç°å‰–æ</a></div></section></div>






  <div class='related-wrap md-text reveal' id="comments">
    <section class='header cmt-title cap theme'>
      Join the discussion
    </section>
    <section class='body cmt-body giscus'>
      

<svg class="loading" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg>

<div id="giscus" data-repo="gaoyanliang/beaudar" data-repo-id="MDEwOlJlcG9zaXRvcnkzOTMzNzI1Nzg=" data-category="Announcements" data-category-id="DIC_kwDOF3Jjos4CTZES" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous"></div>
    </section>
  </div>



      
<footer class="page-footer reveal fs12"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs14">Blog</span><a href="/">Recent Update</a><a href="/blog/categories/">Categories</a><a href="/blog/tags/">Tags</a><a href="/blog/archives/">Archives</a></div><div class="sitemap-group"><span class="fs14">Wiki</span><a href="/wiki/tags/%E6%8A%80%E6%9C%AF%E5%8A%A0%E6%B2%B9%E7%AB%99/">æŠ€æœ¯åŠ æ²¹ç«™</a><a href="/wiki/">...</a></div><div class="sitemap-group"><span class="fs14">Social</span><a href="/friends/">Friends</a><a href="/about/#comments">Comments</a><a target="_blank" rel="noopener" href="https://open.spotify.com/">Spotify</a></div><div class="sitemap-group"><span class="fs14">More</span><a href="/about/">About</a><a href="/wiki/resume">Resume</a><a target="_blank" rel="noopener" href="https://github.com/gyl-coder">GitHub</a></div></div><div class="text"><p>æœ¬ç«™ç”± <a href="/">@yanliang</a> ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> ä¸»é¢˜åˆ›å»ºã€‚<br>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // ä» butterfly å’Œ volantis è·å¾—çµæ„Ÿ
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.18.5';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5';
  stellar.config = {
    date_suffix: {
      just: 'Just',
      min: 'minutes ago',
      hour: 'hours ago',
      day: 'days ago',
      month: 'months ago',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});
  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");

  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  
  // -------- start è‡ªå®šä¹‰é¦–é¡µæ–‡ç« è½®æ’­
  if ('true' == 'true') {
    stellar.plugins.customSwiperTopArticle = Object.assign({"enable":true,"css":"https://cdn.jsdelivr.net/gh/XuxuGood/simple-blog-cdn@main/css/swiper/swiper.min.css","js":"https://cdn.jsdelivr.net/gh/XuxuGood/simple-blog-cdn@main/js/swiper/swiper.min.js","init_js":"https://cdn.jsdelivr.net/gh/XuxuGood/simple-blog-cdn@main/js/swiper/swiper_init.js"});
  }
  // -------- end è‡ªå®šä¹‰é¦–é¡µæ–‡ç« è½®æ’­

  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->

  <script>
  function loadJS() {
    const els = document.querySelectorAll("#comments #giscus");
    if (els.length === 0) return;
    els.forEach((el, i) => {
      try {
        el.innerHTML = '';
      } catch (error) {
        console.log(error);
      }
      var script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.async = true;
      for (let key of Object.keys(el.attributes)) {
        let attr = el.attributes[key];
        if (['class', 'id'].includes(attr.name) === false) {
          script.setAttribute(attr.name, attr.value);
        }
      }
      el.appendChild(script);
    });
  }
  window.addEventListener('DOMContentLoaded', (event) => {
    loadJS();
  });
</script>



<!-- inject -->


  </div>
</body>
</html>
